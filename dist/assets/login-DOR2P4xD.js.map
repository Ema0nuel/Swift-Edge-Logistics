{"version":3,"file":"login-DOR2P4xD.js","sources":["../../src/script/views/User/function/loginHandler.js","../../src/script/views/User/login.js"],"sourcesContent":["import { supabase } from \"../../../utils/supabaseClient.js\";\r\nimport toastr from \"../../../utils/toastr.js\";\r\nimport { sendEmail } from \"../../../utils/send-email.js\";\r\n\r\nexport function loginHandler() {\r\n  const form = document.getElementById(\"loginForm\");\r\n  const spinner = document.getElementById(\"spinner\");\r\n  const loginBtn = document.getElementById(\"loginBtn\");\r\n  const otpSection = document.getElementById(\"otpSection\");\r\n  let userId = null,\r\n    email = \"\";\r\n\r\n  form.onsubmit = async (e) => {\r\n    e.preventDefault();\r\n    loginBtn.disabled = true;\r\n    spinner.style.display = \"inline-block\";\r\n    email = form.email.value.trim();\r\n    const password = form.password.value;\r\n\r\n    if (!email || !password) {\r\n      toastr.error(\"Please fill in all fields.\");\r\n      loginBtn.disabled = false;\r\n      spinner.style.display = \"none\";\r\n      return;\r\n    }\r\n\r\n    // Supabase Auth login\r\n    const { data, error } = await supabase.auth.signInWithPassword({\r\n      email,\r\n      password,\r\n    });\r\n    if (error) {\r\n      toastr.error(error.message || \"Login failed.\");\r\n      loginBtn.disabled = false;\r\n      spinner.style.display = \"none\";\r\n      return;\r\n    }\r\n    userId = data.user.id;\r\n\r\n    // Generate OTP\r\n    const otp = Math.floor(100000 + Math.random() * 900000).toString();\r\n    const expires = new Date(Date.now() + 10 * 60 * 1000).toISOString();\r\n    await supabase.from(\"otps\").insert([\r\n      {\r\n        user_id: userId,\r\n        code: otp,\r\n        type: \"login\",\r\n        expires_at: expires,\r\n      },\r\n    ]);\r\n\r\n    // Send OTP email\r\n    await sendEmail({\r\n      to: email,\r\n      subject: \"Your SwiftEdge Logistics Login OTP\",\r\n      html: `<h2>SwiftEdge Logistics</h2>\r\n        <p>Your OTP code is: <b>${otp}</b></p>\r\n        <p>This code expires in 10 minutes.</p>\r\n        <p>If you did not request this, please ignore.</p>`,\r\n    });\r\n\r\n    toastr.info(\"OTP sent to your email.\");\r\n    form.style.display = \"none\";\r\n    otpSection.classList.remove(\"hidden\");\r\n    loginBtn.disabled = false;\r\n    spinner.style.display = \"none\";\r\n  };\r\n\r\n  document.getElementById(\"verifyOtpBtn\").onclick = async () => {\r\n    const otpInput = document.getElementById(\"otpInput\").value.trim();\r\n    if (!otpInput || otpInput.length !== 6) {\r\n      toastr.error(\"Enter a valid 6-digit OTP.\");\r\n      return;\r\n    }\r\n    spinner.style.display = \"inline-block\";\r\n    // Validate OTP\r\n    const { data, error } = await supabase\r\n      .from(\"otps\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .eq(\"code\", otpInput)\r\n      .eq(\"type\", \"login\")\r\n      .eq(\"is_used\", false)\r\n      .gte(\"expires_at\", new Date().toISOString())\r\n      .single();\r\n\r\n    if (error || !data) {\r\n      toastr.error(\"Invalid or expired OTP.\");\r\n      spinner.style.display = \"none\";\r\n      return;\r\n    }\r\n    // Mark OTP as used\r\n    await supabase.from(\"otps\").update({ is_used: true }).eq(\"id\", data.id);\r\n\r\n    toastr.success(\"Login successful!\");\r\n    setTimeout(() => (window.location.href = \"/dashboard\"), 1200);\r\n  };\r\n\r\n  document.getElementById(\"resendOtpBtn\").onclick = async () => {\r\n    // Resend OTP\r\n    const otp = Math.floor(100000 + Math.random() * 900000).toString();\r\n    const expires = new Date(Date.now() + 10 * 60 * 1000).toISOString();\r\n    await supabase.from(\"otps\").insert([\r\n      {\r\n        user_id: userId,\r\n        code: otp,\r\n        type: \"login\",\r\n        expires_at: expires,\r\n      },\r\n    ]);\r\n    await sendEmail({\r\n      to: email,\r\n      subject: \"Your SwiftEdge Logistics Login OTP\",\r\n      html: `<h2>SwiftEdge Logistics</h2>\r\n        <p>Your new OTP code is: <b>${otp}</b></p>\r\n        <p>This code expires in 10 minutes.</p>`,\r\n    });\r\n    toastr.info(\"OTP resent to your email.\");\r\n  };\r\n}\r\n","import { GlobeSpinner } from \"../../components/GlobeSpinner.js\";\r\nimport { reset } from \"../../utils/reset.js\";\r\nimport Logo from \"/src/images/logo.jpg\";\r\nimport { loginHandler } from \"./function/loginHandler.js\";\r\nimport { checkSession } from \"./function/checkSession.js\";\r\nconst bgImage =\r\n  \"https://cdn.sanity.io/images/db3vqx3o/production/c3d52332b79521e3c086ed42d7b9c4c804f3aa40-2000x1334.webp?w=1280&fm=webp\";\r\n\r\nconst login = async () => {\r\n  reset(\"Login\");\r\n  if (!(await checkSession(true))) return; // If not logged in, redirects to login and stops further code\r\n  const pageEvents = () => {\r\n    document.getElementById(\"themeToggle\")?.addEventListener(\"click\", () => {\r\n      document.documentElement.classList.toggle(\"dark\");\r\n    });\r\n    loginHandler();\r\n  };\r\n\r\n  return {\r\n    html: /* html */`\r\n    <div class=\"min-h-screen flex items-center justify-center transition-colors\"\r\n      style=\"\r\n        background: url('${bgImage}') center/cover no-repeat;\r\n        position: relative;\r\n      \">\r\n      <div class=\"absolute inset-0 bg-white/80 dark:bg-background-dark/90 backdrop-blur-md\"></div>\r\n      <div class=\"relative w-full max-w-md mx-auto bg-white dark:bg-background-dark rounded-2xl shadow-2xl p-8 z-10 border border-primary-dark/10 dark:border-accent-soft/20\">\r\n        <button id=\"themeToggle\" class=\"absolute top-6 right-6 btn btn-circle btn-outline text-xl font-bold\" title=\"Toggle theme\">\r\n          <i class=\"fa-solid fa-moon\"></i>\r\n        </button>\r\n        <div class=\"flex flex-col items-center mb-6\">\r\n          <img src=\"${Logo}\" alt=\"SwiftEdge Logistics Logo\" class=\"h-16 mb-2 rounded-xl shadow-lg border-4 border-primary-dark dark:border-accent-soft bg-white/80 dark:bg-background-dark/80\" />\r\n          <h2 class=\"text-3xl font-extrabold text-primary-dark dark:text-accent-soft mb-1 tracking-tight\">Welcome Back</h2>\r\n          <p class=\"text-lg text-primary-dark dark:text-accent-soft font-semibold mb-2\">Sign in to SwiftEdge Logistics</p>\r\n          <span class=\"text-xs text-gray-500 dark:text-gray-300 mb-2\">Delivering trust, speed & reliability.</span>\r\n        </div>\r\n        <form id=\"loginForm\" class=\"space-y-5\">\r\n          <div class=\"relative\">\r\n            <i class=\"fa-solid fa-envelope absolute left-3 top-3 text-primary-dark dark:text-accent-soft\"></i>\r\n            <input type=\"email\" name=\"email\" autocomplete=\"username\" placeholder=\"Email Address\" class=\"input input-bordered w-full pl-10 py-3 font-semibold focus:ring-2 focus:ring-accent-soft dark:focus:ring-primary-dark transition-all\" required />\r\n          </div>\r\n          <div class=\"relative\">\r\n            <i class=\"fa-solid fa-lock absolute left-3 top-3 text-primary-dark dark:text-accent-soft\"></i>\r\n            <input type=\"password\" name=\"password\" autocomplete=\"current-password\" placeholder=\"Password\" class=\"input input-bordered w-full pl-10 py-3 font-semibold focus:ring-2 focus:ring-accent-soft dark:focus:ring-primary-dark transition-all\" required />\r\n          </div>\r\n          <div class=\"flex items-center justify-between\">\r\n            <label class=\"flex items-center gap-2 text-sm font-medium\">\r\n              <input type=\"checkbox\" name=\"remember\" class=\"checkbox accent-primary-dark dark:accent-accent-soft\" />\r\n              <span>Remember me</span>\r\n            </label>\r\n            <a href=\"/user/forgot-password\" class=\"text-accent-dark dark:text-accent-soft hover:underline text-sm font-bold\" data-nav>Forgot password?</a>\r\n          </div>\r\n          <button type=\"submit\" class=\"btn btn-primary w-full flex items-center justify-center gap-2 text-lg font-bold py-3 bg-gradient-to-r from-primary-dark to-accent-soft text-white shadow-lg hover:scale-105 transition-transform active:scale-95\" id=\"loginBtn\">\r\n            <i class=\"fa-solid fa-right-to-bracket\"></i>\r\n            <span>Login</span>\r\n            <span id=\"spinner\" style=\"display:none;\">${GlobeSpinner({ size: 24, color: \"#0d9488\" })}</span>\r\n          </button>\r\n          <div class=\"mt-2 text-center\">\r\n            <span class=\"text-sm font-medium text-gray-600 dark:text-gray-300\">New to SwiftEdge?</span>\r\n            <a href=\"/signup\" class=\"text-accent-dark dark:text-accent-soft hover:underline text-sm ml-2 font-bold\" data-nav>Create account</a>\r\n          </div>\r\n        </form>\r\n        <div id=\"otpSection\" class=\"hidden mt-6\">\r\n          <h3 class=\"text-lg font-semibold mb-2 text-primary-dark dark:text-accent-soft\">Enter OTP</h3>\r\n          <input type=\"text\" id=\"otpInput\" maxlength=\"6\" class=\"input input-bordered w-full mb-2 py-3 font-semibold focus:ring-2 focus:ring-accent-soft dark:focus:ring-primary-dark\" placeholder=\"6-digit OTP\" />\r\n          <button id=\"verifyOtpBtn\" class=\"btn btn-accent w-full font-bold py-3 bg-gradient-to-r from-accent-soft to-primary-dark text-white\">Verify OTP</button>\r\n          <button id=\"resendOtpBtn\" class=\"btn btn-link w-full mt-2 font-bold text-primary-dark dark:text-accent-soft\">Resend OTP</button>\r\n        </div>\r\n        <div class=\"mt-8 text-center text-xs text-gray-400 dark:text-gray-500\">\r\n          <span>SwiftEdge Logistics &copy; ${new Date().getFullYear()} &mdash; Secure. Fast. Reliable.</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    `,\r\n    pageEvents,\r\n  };\r\n};\r\n\r\nexport default login;\r\n"],"names":["loginHandler","form","spinner","loginBtn","otpSection","userId","email","e","password","toastr","data","error","supabase","otp","expires","sendEmail","otpInput","bgImage","login","reset","checkSession","pageEvents","Logo","GlobeSpinner"],"mappings":"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"}