{"version":3,"file":"dashboard-DhPiGeP_.js","sources":["../../src/script/views/User/dashboard.js"],"sourcesContent":["import Navbar from \"./components/navbar\";\r\nimport { supabase } from \"../../utils/supabaseClient\"; // <-- FIX: use named import\r\nimport logo from \"/src/images/logo.jpg\";\r\nimport { checkSession } from \"./function/checkSession\";\r\nimport { reset } from \"../../utils/reset\";\r\n\r\n// Fetch user profile and notifications from Supabase\r\nasync function fetchUserAndNotifications() {\r\n  // Get current user\r\n  const { data: { user } } = await supabase.auth.getUser();\r\n  if (!user) return { profile: null, notifications: [] };\r\n\r\n  // Fetch profile\r\n  const { data: profile } = await supabase\r\n    .from(\"profiles\")\r\n    .select(\"*\")\r\n    .eq(\"id\", user.id)\r\n    .single();\r\n\r\n  // Fetch notifications (latest 10)\r\n  const { data: notifications } = await supabase\r\n    .from(\"notifications\")\r\n    .select(\"*\")\r\n    .eq(\"user_id\", user.id)\r\n    .order(\"created_at\", { ascending: false })\r\n    .limit(3);\r\n\r\n  return { profile, notifications: notifications || [] };\r\n}\r\n\r\nconst dashboard = async () => {\r\n  if (!(await checkSession())) return;\r\n  reset(\"Dashboard\");\r\n  // Fetch user and notifications\r\n  const { profile, notifications } = await fetchUserAndNotifications();\r\n\r\n  // Navbar\r\n  const { html: navbarHtml, pageEvents: navbarEvents } = Navbar(\"dashboard\");\r\n\r\n  // Hero Section\r\n  const hero = `\r\n    <section class=\"relative w-full h-64 md:h-80 flex items-center justify-center overflow-hidden rounded-b-2xl shadow-lg mb-8\"\r\n      style=\"background: url('https://www.wowtheme7.com/tf/transpro/assets/img/banner/breadcrumb.png') center/cover no-repeat, #1e293b;\">\r\n      <div class=\"absolute inset-0 bg-gradient-to-b from-black/60 to-background-dark/90\"></div>\r\n      <div class=\"relative z-10 flex flex-col items-center justify-center w-full h-full\">\r\n        <img src=\"${logo}\" alt=\"SwiftEdge Logo\" class=\"h-20 w-20 mb-2 rounded-full bg-white shadow-lg\" />\r\n        <h1 class=\"text-4xl md:text-5xl font-extrabold text-white drop-shadow-lg mb-2\">Welcome${profile?.full_name ? `, ${profile.full_name}` : \"\"}!</h1>\r\n        <p class=\"text-lg text-accent mt-2 font-semibold\">Your role: <span class=\"uppercase\">${profile?.role || \"user\"}</span></p>\r\n      </div>\r\n    </section>\r\n  `;\r\n\r\n  // Dashboard Quick Links\r\n  const quickLinks = `\r\n    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6 mt-8\">\r\n      <a href=\"/prepare\" data-nav class=\"bg-gradient-to-br from-primary to-accent p-6 rounded-xl shadow-lg hover:shadow-2xl transform hover:-translate-y-1 transition-all duration-300 cursor-pointer flex flex-col items-start\">\r\n        <h3 class=\"text-2xl font-bold text-white mb-3\">Prepare a Package</h3>\r\n        <p class=\"text-white text-opacity-90\">Set up your package for delivery and get an instant quote.</p>\r\n        <span class=\"mt-4 px-5 py-2 bg-white text-primary font-semibold rounded-full shadow-md hover:bg-peach transition-colors duration-200\">Get Started</span>\r\n      </a>\r\n      <a href=\"/track\" data-nav class=\"bg-gradient-to-br from-green-600 to-accent p-6 rounded-xl shadow-lg hover:shadow-2xl transform hover:-translate-y-1 transition-all duration-300 cursor-pointer flex flex-col items-start\">\r\n        <h3 class=\"text-2xl font-bold text-white mb-3\">Track Your Product</h3>\r\n        <p class=\"text-white text-opacity-90\">Monitor the real-time status of your shipments.</p>\r\n        <span class=\"mt-4 px-5 py-2 bg-white text-green-700 font-semibold rounded-full shadow-md hover:bg-peach transition-colors duration-200\">Track Now</span>\r\n      </a>\r\n    </div>\r\n  `;\r\n\r\n  // Notifications List\r\n  const notificationList = notifications.length\r\n    ? notifications\r\n        .map(\r\n          (n) => `\r\n        <div class=\"w-full max-w-xl bg-peach dark:bg-background-dark border-l-4 ${\r\n          n.is_read ? \"border-accent\" : \"border-primary\"\r\n        } p-4 rounded shadow cursor-pointer notification-item\" data-id=\"${n.id}\">\r\n          <div class=\"flex items-center gap-2 mb-1\">\r\n            <i class=\"fa ${n.title?.toLowerCase().includes(\"delivered\") ? \"fa-box\" : \"fa-bell\"} text-primary dark:text-accent\"></i>\r\n            <span class=\"font-semibold\">${n.title}</span>\r\n            <span class=\"ml-auto text-xs text-text-subtle\">${new Date(n.created_at).toLocaleString()}</span>\r\n          </div>\r\n          <div class=\"text-sm text-text-dark dark:text-text-light truncate\">${n.message}</div>\r\n        </div>\r\n      `\r\n        )\r\n        .join(\"\")\r\n    : `<div class=\"text-center text-text-subtle py-8\">No notifications yet.</div>`;\r\n\r\n  // Modal for notification details\r\n  const modalHtml = `\r\n    <div id=\"notification-modal\" class=\"fixed inset-0 flex items-center justify-center z-[99999] bg-black bg-opacity-50 hidden\">\r\n      <div class=\"bg-white dark:bg-background-dark p-6 rounded-lg shadow-xl max-w-md w-full relative\">\r\n        <button id=\"close-modal-btn\" class=\"absolute top-2 right-2 text-xl text-text-subtle hover:text-accent\">&times;</button>\r\n        <h3 id=\"modal-title\" class=\"text-xl font-bold mb-2\"></h3>\r\n        <p id=\"modal-message\" class=\"mb-4\"></p>\r\n        <div class=\"text-xs text-text-subtle\" id=\"modal-date\"></div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Main Dashboard HTML\r\n  const html = `\r\n    <div class=\"min-h-screen bg-[#1e293b] dark:bg-background-dark transition-colors duration-300 bg-cover bg-center\"\r\n      style=\"background-image: url('https://www.wowtheme7.com/tf/transpro/assets/img/banner/breadcrumb.png'); background-blend-mode: multiply;\">\r\n      ${navbarHtml}\r\n      <main id=\"dashboard-main\" class=\"container mx-auto px-2 py-6 min-h-[80vh]\">\r\n        ${hero}\r\n        <div class=\"flex flex-col md:flex-row gap-8\">\r\n          <div class=\"flex-1\">\r\n            <h2 class=\"text-2xl font-bold mb-4 text-primary dark:text-accent\">Quick Actions</h2>\r\n            ${quickLinks}\r\n          </div>\r\n          <aside class=\"w-full md:w-96\">\r\n            <div class=\"bg-white/90 dark:bg-background-dark/80 rounded-lg shadow-lg p-6 mb-6\">\r\n              <div class=\"flex items-center gap-3 mb-4\">\r\n                <img src=\"${profile?.avatar_url || logo}\" alt=\"Avatar\" class=\"h-12 w-12 rounded-full border-2 border-accent object-cover\" />\r\n                <div>\r\n                  <div class=\"font-bold text-lg text-primary dark:text-accent\">${profile?.full_name || \"User\"}</div>\r\n                  <div class=\"text-xs text-text-subtle\">Role: <span class=\"uppercase\">${profile?.role || \"user\"}</span></div>\r\n                </div>\r\n              </div>\r\n              <div class=\"text-sm text-text-subtle\">Phone: ${profile?.phone || \"N/A\"}</div>\r\n              <div class=\"text-sm text-text-subtle\">Joined: ${profile?.created_at ? new Date(profile.created_at).toLocaleDateString() : \"N/A\"}</div>\r\n            </div>\r\n            <div class=\"bg-white/90 dark:bg-background-dark/80 rounded-lg shadow-lg p-6\">\r\n              <h3 class=\"text-lg font-bold mb-3 text-primary dark:text-accent\">Recent Notifications</h3>\r\n              <div class=\"flex flex-col gap-3\">\r\n                ${notificationList}\r\n              </div>\r\n            </div>\r\n          </aside>\r\n        </div>\r\n        <div class=\"mt-12 text-center\">\r\n          <h3 class=\"text-2xl font-semibold text-text-dark dark:text-text-light mb-4\">Our Commitment</h3>\r\n          <p class=\"text-md text-text-subtle dark:text-text-light max-w-xl mx-auto\">\r\n            At SwiftEdge, we are committed to providing unparalleled service, ensuring your packages arrive safely and on time, and helping you sell your valuable items with ease.\r\n          </p>\r\n        </div>\r\n      </main>\r\n      ${modalHtml}\r\n      <footer class=\"bg-white/80 dark:bg-background-dark/80 shadow-inner mt-12 py-6 text-center text-text-subtle dark:text-text-light transition-colors duration-300\">\r\n        <p>&copy; ${new Date().getFullYear()} SwiftEdge Logistics. All rights reserved.</p>\r\n        <p class=\"text-sm mt-2\">Designed for efficient logistics.</p>\r\n      </footer>\r\n      <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css\">\r\n    </div>\r\n  `;\r\n\r\n  function pageEvents() {\r\n    navbarEvents();\r\n\r\n    // Modal logic for notifications\r\n    document.querySelectorAll(\".notification-item\").forEach((el) => {\r\n      el.addEventListener(\"click\", () => {\r\n        const id = el.getAttribute(\"data-id\");\r\n        const notif = notifications.find((n) => n.id === id);\r\n        if (!notif) return;\r\n        document.getElementById(\"modal-title\").textContent = notif.title;\r\n        document.getElementById(\"modal-message\").textContent = notif.message;\r\n        document.getElementById(\"modal-date\").textContent = new Date(notif.created_at).toLocaleString();\r\n        document.getElementById(\"notification-modal\").classList.remove(\"hidden\");\r\n      });\r\n    });\r\n    const closeBtn = document.getElementById(\"close-modal-btn\");\r\n    if (closeBtn) {\r\n      closeBtn.onclick = () => {\r\n        document.getElementById(\"notification-modal\").classList.add(\"hidden\");\r\n      };\r\n    }\r\n    // Close modal on backdrop click\r\n    document.getElementById(\"notification-modal\")?.addEventListener(\"click\", (e) => {\r\n      if (e.target.id === \"notification-modal\") {\r\n        document.getElementById(\"notification-modal\").classList.add(\"hidden\");\r\n      }\r\n    });\r\n  }\r\n\r\n  return { html, pageEvents };\r\n};\r\n\r\nexport default dashboard;"],"names":["fetchUserAndNotifications","user","supabase","profile","notifications","dashboard","checkSession","reset","navbarHtml","navbarEvents","Navbar","hero","logo","quickLinks","notificationList","n","html","pageEvents","el","id","notif","closeBtn","e"],"mappings":"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"}