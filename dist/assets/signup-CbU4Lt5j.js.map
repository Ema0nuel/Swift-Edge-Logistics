{"version":3,"file":"signup-CbU4Lt5j.js","sources":["../../src/script/views/User/function/signupHandler.js","../../src/script/views/User/signup.js"],"sourcesContent":["import { supabase } from \"../../../utils/supabaseClient.js\";\r\nimport toastr from \"../../../utils/toastr.js\";\r\nimport { sendEmail } from \"../../../utils/send-email.js\";\r\n\r\nexport function signupHandler() {\r\n  const form = document.getElementById(\"signupForm\");\r\n  const spinner = document.getElementById(\"spinner\");\r\n  const signupBtn = document.getElementById(\"signupBtn\");\r\n  const otpSection = document.getElementById(\"otpSection\");\r\n  let userId = null,\r\n    email = \"\";\r\n\r\n  form.onsubmit = async (e) => {\r\n    e.preventDefault();\r\n    signupBtn.disabled = true;\r\n    spinner.style.display = \"inline-block\";\r\n    const full_name = form.full_name.value.trim();\r\n    email = form.email.value.trim();\r\n    const phone = form.phone.value.trim();\r\n    const password = form.password.value;\r\n    const confirm_password = form.confirm_password.value;\r\n    const role = form.role.value;\r\n    const terms = form.terms.checked;\r\n\r\n    // Client-side validation\r\n    if (\r\n      !full_name ||\r\n      !email ||\r\n      !phone ||\r\n      !password ||\r\n      !confirm_password ||\r\n      !role\r\n    ) {\r\n      toastr.error(\"Please fill in all fields.\");\r\n      signupBtn.disabled = false;\r\n      spinner.style.display = \"none\";\r\n      return;\r\n    }\r\n    if (!terms) {\r\n      toastr.error(\"You must agree to the Terms & Privacy.\");\r\n      signupBtn.disabled = false;\r\n      spinner.style.display = \"none\";\r\n      return;\r\n    }\r\n    if (password !== confirm_password) {\r\n      toastr.error(\"Passwords do not match.\");\r\n      signupBtn.disabled = false;\r\n      spinner.style.display = \"none\";\r\n      return;\r\n    }\r\n    if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) {\r\n      toastr.error(\"Invalid email format.\");\r\n      signupBtn.disabled = false;\r\n      spinner.style.display = \"none\";\r\n      return;\r\n    }\r\n\r\n    // Supabase Auth signup\r\n    const { data, error } = await supabase.auth.signUp({ email, password });\r\n    if (error) {\r\n      toastr.error(error.message || \"Signup failed.\");\r\n      signupBtn.disabled = false;\r\n      spinner.style.display = \"none\";\r\n      return;\r\n    }\r\n    userId = data.user.id;\r\n\r\n    // Insert profile\r\n    await supabase.from(\"profiles\").insert([\r\n      {\r\n        id: userId,\r\n        full_name,\r\n        phone,\r\n        role,\r\n        avatar_url: \"\",\r\n        email,\r\n      },\r\n    ]);\r\n\r\n    // Generate OTP\r\n    const otp = Math.floor(100000 + Math.random() * 900000).toString();\r\n    const expires = new Date(Date.now() + 10 * 60 * 1000).toISOString();\r\n    await supabase.from(\"otps\").insert([\r\n      {\r\n        user_id: userId,\r\n        code: otp,\r\n        type: \"signup\",\r\n        expires_at: expires,\r\n      },\r\n    ]);\r\n\r\n    // Send welcome email with OTP\r\n    await sendEmail({\r\n      to: email,\r\n      subject: \"Welcome to SwiftEdge Logistics! Verify your account\",\r\n      html: `<h2>Welcome to SwiftEdge Logistics</h2>\r\n        <p>Hi ${full_name},</p>\r\n        <p>Your OTP code is: <b>${otp}</b></p>\r\n        <p>This code expires in 10 minutes.</p>\r\n        <p>Contact: Swiftedgelogistics01@gmail.com | +15022095647</p>`,\r\n    });\r\n\r\n    toastr.success(\"Signup successful! OTP sent to your email.\");\r\n    form.style.display = \"none\";\r\n    otpSection.classList.remove(\"hidden\");\r\n    signupBtn.disabled = false;\r\n    spinner.style.display = \"none\";\r\n  };\r\n\r\n  document.getElementById(\"verifyOtpBtn\").onclick = async () => {\r\n    const otpInput = document.getElementById(\"otpInput\").value.trim();\r\n    if (!otpInput || otpInput.length !== 6) {\r\n      toastr.error(\"Enter a valid 6-digit OTP.\");\r\n      return;\r\n    }\r\n    spinner.style.display = \"inline-block\";\r\n    // Validate OTP\r\n    const { data, error } = await supabase\r\n      .from(\"otps\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .eq(\"code\", otpInput)\r\n      .eq(\"type\", \"signup\")\r\n      .eq(\"is_used\", false)\r\n      .gte(\"expires_at\", new Date().toISOString())\r\n      .single();\r\n\r\n    if (error || !data) {\r\n      toastr.error(\"Invalid or expired OTP.\");\r\n      spinner.style.display = \"none\";\r\n      return;\r\n    }\r\n    // Mark OTP as used\r\n    await supabase.from(\"otps\").update({ is_used: true }).eq(\"id\", data.id);\r\n\r\n    toastr.success(\"Account verified! Redirecting...\");\r\n    setTimeout(() => (window.location.href = \"/dashboard\"), 1200);\r\n  };\r\n\r\n  document.getElementById(\"resendOtpBtn\").onclick = async () => {\r\n    // Resend OTP\r\n    const otp = Math.floor(100000 + Math.random() * 900000).toString();\r\n    const expires = new Date(Date.now() + 10 * 60 * 1000).toISOString();\r\n    await supabase.from(\"otps\").insert([\r\n      {\r\n        user_id: userId,\r\n        code: otp,\r\n        type: \"signup\",\r\n        expires_at: expires,\r\n      },\r\n    ]);\r\n    await sendEmail({\r\n      to: email,\r\n      subject: \"Your SwiftEdge Logistics Signup OTP\",\r\n      html: `<h2>SwiftEdge Logistics</h2>\r\n        <p>Your new OTP code is: <b>${otp}</b></p>\r\n        <p>This code expires in 10 minutes.</p>`,\r\n    });\r\n    toastr.info(\"OTP resent to your email.\");\r\n  };\r\n}\r\n","import { GlobeSpinner } from \"../../components/GlobeSpinner.js\";\r\nimport { reset } from \"../../utils/reset.js\";\r\nimport Logo from '/src/images/logo.jpg';\r\nimport { signupHandler } from \"./function/signupHandler.js\";\r\nconst bgImage = \"https://cdn.sanity.io/images/db3vqx3o/production/c3d52332b79521e3c086ed42d7b9c4c804f3aa40-2000x1334.webp?w=1280&fm=webp\";\r\n\r\nconst signup = () => {\r\n  reset(\"Sign up\");\r\n  const pageEvents = () => {\r\n    document.getElementById(\"themeToggle\")?.addEventListener(\"click\", () => {\r\n      document.documentElement.classList.toggle(\"dark\");\r\n    });\r\n    signupHandler();\r\n  };\r\n\r\n  return {\r\n    html: `\r\n    <div class=\"min-h-screen flex items-center justify-center transition-colors\"\r\n      style=\"\r\n        background: url('${bgImage}') center/cover no-repeat;\r\n        position: relative;\r\n      \">\r\n      <div class=\"absolute inset-0 bg-white/80 dark:bg-background-dark/90 backdrop-blur-md\"></div>\r\n      <div class=\"relative w-full max-w-lg mx-auto bg-white dark:bg-background-dark rounded-2xl shadow-2xl p-8 z-10 border border-primary-dark/10 dark:border-accent-soft/20\">\r\n        <button id=\"themeToggle\" class=\"absolute top-6 right-6 btn btn-circle btn-outline text-xl font-bold\" title=\"Toggle theme\">\r\n          <i class=\"fa-solid fa-moon\"></i>\r\n        </button>\r\n        <div class=\"flex flex-col items-center mb-6\">\r\n          <img src=\"${Logo}\" alt=\"SwiftEdge Logistics Logo\" class=\"h-16 mb-2 rounded-xl shadow-lg border-4 border-primary-dark dark:border-accent-soft bg-white/80 dark:bg-background-dark/80\" />\r\n          <h2 class=\"text-3xl font-extrabold text-primary-dark dark:text-accent-soft mb-1 tracking-tight\">Create Your Account</h2>\r\n          <p class=\"text-lg text-primary-dark dark:text-accent-soft font-semibold mb-2\">Join SwiftEdge Logistics</p>\r\n          <span class=\"text-xs text-gray-500 dark:text-gray-300 mb-2\">Your journey to seamless delivery starts here.</span>\r\n        </div>\r\n        <form id=\"signupForm\" class=\"space-y-5\">\r\n          <div class=\"relative\">\r\n            <i class=\"fa-solid fa-user absolute left-3 top-3 text-primary-dark dark:text-accent-soft\"></i>\r\n            <input type=\"text\" name=\"full_name\" autocomplete=\"name\" placeholder=\"Full Name\" class=\"input input-bordered w-full pl-10 py-3 font-semibold focus:ring-2 focus:ring-accent-soft dark:focus:ring-primary-dark transition-all\" required />\r\n          </div>\r\n          <div class=\"relative\">\r\n            <i class=\"fa-solid fa-envelope absolute left-3 top-3 text-primary-dark dark:text-accent-soft\"></i>\r\n            <input type=\"email\" name=\"email\" autocomplete=\"email\" placeholder=\"Email Address\" class=\"input input-bordered w-full pl-10 py-3 font-semibold focus:ring-2 focus:ring-accent-soft dark:focus:ring-primary-dark transition-all\" required />\r\n          </div>\r\n          <div class=\"relative\">\r\n            <i class=\"fa-solid fa-phone absolute left-3 top-3 text-primary-dark dark:text-accent-soft\"></i>\r\n            <input type=\"tel\" name=\"phone\" autocomplete=\"tel\" placeholder=\"Phone Number\" class=\"input input-bordered w-full pl-10 py-3 font-semibold focus:ring-2 focus:ring-accent-soft dark:focus:ring-primary-dark transition-all\" required />\r\n          </div>\r\n          <div class=\"relative\">\r\n            <i class=\"fa-solid fa-lock absolute left-3 top-3 text-primary-dark dark:text-accent-soft\"></i>\r\n            <input type=\"password\" name=\"password\" autocomplete=\"new-password\" placeholder=\"Password\" class=\"input input-bordered w-full pl-10 py-3 font-semibold focus:ring-2 focus:ring-accent-soft dark:focus:ring-primary-dark transition-all\" required />\r\n          </div>\r\n          <div class=\"relative\">\r\n            <i class=\"fa-solid fa-lock absolute left-3 top-3 text-primary-dark dark:text-accent-soft\"></i>\r\n            <input type=\"password\" name=\"confirm_password\" autocomplete=\"new-password\" placeholder=\"Confirm Password\" class=\"input input-bordered w-full pl-10 py-3 font-semibold focus:ring-2 focus:ring-accent-soft dark:focus:ring-primary-dark transition-all\" required />\r\n          </div>\r\n          <div>\r\n            <label class=\"block text-sm mb-1 font-bold text-primary-dark dark:text-accent-soft\">Account Type</label>\r\n            <select name=\"role\" class=\"input input-bordered w-full py-3 font-semibold focus:ring-2 focus:ring-accent-soft dark:focus:ring-primary-dark transition-all\" required>\r\n              <option value=\"user\">Customer</option>\r\n              <option value=\"trader\">Vendor</option>\r\n            </select>\r\n          </div>\r\n          <label class=\"flex items-center gap-2 text-sm font-medium\">\r\n            <input type=\"checkbox\" name=\"terms\" class=\"checkbox accent-primary-dark dark:accent-accent-soft\" required />\r\n            <span>I agree to the <a href=\"/terms\" data-nav class=\"text-accent-dark dark:text-accent-soft hover:underline font-bold\">Terms & Privacy</a></span>\r\n          </label>\r\n          <button type=\"submit\" class=\"btn btn-primary w-full flex items-center justify-center gap-2 text-lg font-bold py-3 bg-gradient-to-r from-primary-dark to-accent-soft text-white shadow-lg hover:scale-105 transition-transform active:scale-95\" id=\"signupBtn\">\r\n            <i class=\"fa-solid fa-user-plus\"></i>\r\n            <span>Sign Up</span>\r\n            <span id=\"spinner\" style=\"display:none;\">${GlobeSpinner({ size: 24, color: \"#0d9488\" })}</span>\r\n          </button>\r\n          <div class=\"mt-2 text-center\">\r\n            <span class=\"text-sm font-medium text-gray-600 dark:text-gray-300\">Already have an account?</span>\r\n            <a href=\"/user/login\" class=\"text-accent-dark dark:text-accent-soft hover:underline text-sm ml-2 font-bold\" data-nav>Login</a>\r\n          </div>\r\n        </form>\r\n        <div id=\"otpSection\" class=\"hidden mt-6\">\r\n          <h3 class=\"text-lg font-semibold mb-2 text-primary-dark dark:text-accent-soft\">Enter OTP</h3>\r\n          <input type=\"text\" id=\"otpInput\" maxlength=\"6\" class=\"input input-bordered w-full mb-2 py-3 font-semibold focus:ring-2 focus:ring-accent-soft dark:focus:ring-primary-dark\" placeholder=\"6-digit OTP\" />\r\n          <button id=\"verifyOtpBtn\" class=\"btn btn-accent w-full font-bold py-3 bg-gradient-to-r from-accent-soft to-primary-dark text-white\">Verify OTP</button>\r\n          <button id=\"resendOtpBtn\" class=\"btn btn-link w-full mt-2 font-bold text-primary-dark dark:text-accent-soft\">Resend OTP</button>\r\n        </div>\r\n        <div class=\"mt-8 text-center text-xs text-gray-400 dark:text-gray-500\">\r\n          <span>SwiftEdge Logistics &copy; ${new Date().getFullYear()} &mdash; Trusted by thousands.</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    `,\r\n    pageEvents,\r\n  };\r\n};\r\n\r\nexport default signup;"],"names":["signupHandler","form","spinner","signupBtn","otpSection","userId","email","e","full_name","phone","password","confirm_password","role","terms","toastr","data","error","supabase","otp","expires","sendEmail","otpInput","bgImage","signup","reset","pageEvents","Logo","GlobeSpinner"],"mappings":"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"}